<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Identificador VÃ­ctima y Agresor</title>

    <style>
        body { font-family: Arial; margin: 40px; }
        #results { margin-top: 20px; }
        video, img { max-width: 100%; margin-top: 10px; }
        .loader { display: none; font-weight: bold; color: #444; }
    </style>
</head>
<body>

<h1>Identificador VÃ­ctima y Agresor</h1>

<p>Sube un video o ingresa una URL de YouTube:</p>

<form id="form">
    <input type="file" id="video" name="video" accept="video/*"><br><br>
    <input type="text" id="youtube_url" name="youtube_url" placeholder="https://youtube.com/..."><br><br>

    <label>Mostrar interacciÃ³n:</label>
    <select id="mostrar_interaccion" name="mostrar_interaccion">
        <option value="Ambos">Ambos</option>
        <option value="Agresor">Agresor</option>
        <option value="VÃ­ctima">VÃ­ctima</option>
    </select>

    <br><br>
    <button type="submit">Procesar Video</button>
</form>

<div id="loader" class="loader">Procesando... Esto puede tardar 20â€“40 segundos.</div>

<div id="results"></div>

<script>
const BACKEND_BASE = "/api";  // ðŸ”¥ No tocar si usas vercel.json

const form = document.getElementById("form");
const results = document.getElementById("results");
const loader = document.getElementById("loader");

form.addEventListener("submit", async (e) => {
    e.preventDefault();
    loader.style.display = "block";
    results.innerHTML = "";

    const fd = new FormData(form);

    const r = await fetch(BACKEND_BASE + "/process", {
        method: "POST",
        body: fd
    });

    const data = await r.json();
    loader.style.display = "none";

    if (data.error) {
        results.innerHTML = `<p style="color:red">${data.error}</p>`;
        return;
    }

    let html = "";

    if (data.resumen) {
        html += `<pre>${data.resumen}</pre>`;
    }

    if (data.video) {
        html += `<h3>Video procesado</h3>
        <video id="output-video" controls src="data:video/mp4;base64,${data.video}"></video>`;
    }

    if (data.selected_img) {
        html += `<h3>Frame seleccionado</h3>
        <img id="output-img" src="data:image/jpeg;base64,${data.selected_img}">`;
    }

    results.innerHTML = html;
});

/* Cambio de imagen sin reprocesar */
async function changeImage() {
    const fd = new FormData();
    fd.append("mostrar_interaccion", document.getElementById("mostrar_interaccion").value);

    const r = await fetch(BACKEND_BASE + "/change_image", {
        method: "POST",
        body: fd
    });

    const data = await r.json();
    if (data.selected_img) {
        document.getElementById("output-img").src =
            "data:image/jpeg;base64," + data.selected_img;
    }
}

document.getElementById("mostrar_interaccion").addEventListener("change", changeImage);
</script>

</body>
</html>
